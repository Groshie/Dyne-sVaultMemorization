<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on tisdag, november 01, 2022, 2:51  -->
<!-- MuClient version 5.06 -->

<!-- Plugin "Dynes_Vault_Memorization" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Dynes_Vault_Memorization"
   author="Groshie"
   id="852bd6e8cfc1a45de7acb6bc"
   language="JScript"
   purpose="To memorize contents of containers for you!"
   date_written="2022-11-01 14:47:43"
   requires="3.48"
   version="1.0"
   >
<description trim="y">
<![CDATA[
You can use this plugin to remember container/vault contents for you!
]]>
</description>

</plugin>

<!--  Aliases  -->

<aliases>
  <alias
   name="vaultsRemove"
   script="vaultRemove"
   match="vaultsRemove *"
   enabled="y"
   sequence="100"
  >
  </alias>
  <alias
   name="vaultsAdd"
   script="vaultAdd"
   match="vaultsAdd *"
   enabled="y"
   sequence="100"
  >
  </alias>
  <alias
   name="vaultsShow"
   script="vaultShow"
   match="vaults *"
   enabled="y"
   sequence="100"
  >
  </alias>
  <alias
   name="vaultsHelp"
   script="vaultHelp"
   match="vaultsHelp"
   enabled="y"
   sequence="100"
  >
  </alias>
  <alias
   name="vaultsList"
   script="vaultList"
   match="vaults"
   enabled="y"
   sequence="100"
  >
  </alias>
</aliases>

<!--  Variables  -->

<variables>
  <variable name="vaults"></variable>
</variables>

<!--  Script  -->


<script>
<![CDATA[
/*
###########################
### Dyne's Vault Memory ###
###########################

#####################
# Contents:         #
# 1. Functions      #
# 2. Application    #
#####################
*/

// ### FUNCTIONS ###
// Add a vault (vaultsAdd <stored name>)
function vaultAdd(name, line, wildcards) {
    var vaultName = line.replace("vaultsAdd ", "");
    var vaultText = world.GetRecentLines(50);
    var currentTime = new Date();
    var exists = 0;

    vaultText = vaultText.match(/(The .+?(contains|full|empty).+with.+[.])|(It is.+(full|empty) with: .+[.])|(^The.+?(contains|full|empty).+except.+[.])$/g);
    
    var vaultList = world.getVariable("vaults");
    var newVaultList = "";

    if (vaultList == "") {
        newVaultList = vaultName + ";" + vaultText + ";" + currentTime + "\r\n";
        world.note("Vault " + vaultName + " added!");
    } else {
        vaultList = vaultList.split("\r\n");

        for (line in vaultList) {
            var thisLine = vaultList[line].split(";");

            if (thisLine[0] == vaultName) {
                newVaultList += vaultName + ";" + vaultText + ";" + currentTime + "\r\n";
                world.note("Vault " + vaultName + " replaced!");
                exists = 1;
                continue
            }

            newVaultList += thisLine;
        }

        if (exists == 0) {
            newVaultList += vaultName + ";" + vaultText + ";" + currentTime + "\r\n";
            world.note("Vault " + vaultName + " added!");
        }
    }

    world.SetVariable("vaults", newVaultList);
    return
}

// List vaults
function vaultList() {
    var vaultsList = world.getVariable("vaults");

    if (vaultsList == "") {
        world.note("No vaults recorded yet!");
    } else {
        vaultsList = vaultsList.split("\r\n");

        for (line in vaultsList) {
            var thisLine = vaultsList[line].split(";");
            world.note(thisLine[0]);
        }
        world.note("--- All recorded vaults listed ---");
    }
    return
}

// List contents of a vault
function vaultShow(name, line, wildcards) {
    var vaultName = line.replace("vaults ", "");
    var vaultList = world.getVariable("vaults");
    vaultList = vaultList.split("\r\n");

    for (line in vaultList) {
        var thisLine = vaultList[line].split(";");

        if (thisLine[0] == vaultName) {
            world.note("Vault name: " + thisLine[0]);
            world.note("Contents:\n" + thisLine[1]);
            world.note("Last updated: " + thisLine[2]);
            return
        }
    }

    world.note("No such vault found! (Case-sensitive)");
    return
}

// Remove a vault
function vaultRemove(name, line, wildcards) {
    var vaultName = line.replace("vaultsRemove ", "");
    var vaultList = world.getVariable("vaults");
    var newVaultList = "";
    vaultList = vaultList.split("\r\n");

    for (line in vaultList) {
        var thisLine = vaultList[line].split(";");

        if (thisLine[0] == vaultName) {
            world.note("Vault with name " + thisLine[0] + " was removed!")
            continue
        }

        newVaultList += thisLine;
    }

    world.SetVariable("vaults", newVaultList);
    return
}

// Helpfile
function vaultHelp() {
    world.note("To add a vault, first look at your chosen container, then use the 'vaultsAdd'-command!\r\n")
    world.note("The following (case-sensitive) commands are available:");
    world.note("'vaultsAdd': Adds a vault to the list (auto-overwrites).");
    world.note("'vaults': Shows your current list of vaults.");
    world.note("'vaultsShow <vault>': Shows chosen vault contents if in list.");
    world.note("'vaultsRemove <vault>': Removes chosen vault if in list.");
    world.note("'vaultsHelp': Shows this information.");
}


// ### APPLICATION ###
// Check if variable "vaults" exists
if (!world.getVariable("vaults")) {
	world.SetVariable("vaults", "");
    world.note("Dyne's Vault Memorization: 'vaults'-variable created!");
}

// Check if aliases are created
if (world.GetAliasOption("vaultsAdd", "enabled") == 1) {
	// Alias "vaultsAdd" is enabled
} else {
    // AddAlias("aliasName", "playercommand", "", 1, "Function")
    world.AddAlias("vaultsAdd", "vaultsAdd *", "", 1, "vaultAdd");
    world.AddAlias("vaultsList", "vaults", "", 1, "vaultList");
    world.AddAlias("vaultsShow", "vaults *", "", 1, "vaultShow");
	world.AddAlias("vaultsRemove", "vaultsRemove *", "", 1, "vaultRemove");
    world.AddAlias("vaultsHelp", "vaultsHelp", "", 1, "vaultHelp");
    world.Note("Dyne's Vault Memorization is initialized!");
}
]]>
</script>


</muclient>
